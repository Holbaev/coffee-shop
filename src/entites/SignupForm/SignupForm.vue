<script>
import { signup } from "../../shared/service/RegisterService";
import { toast } from "vue3-toastify";
import "vue3-toastify/dist/index.css";

export default {
  data() {
    return {
      username: "",
      email: "",
      password: "",
    };
  },

  mounted() {},

  methods: {
    async signUp() {
      if(this.username == ""){
        toast.warning("Напишите свое имя.", {
          autoClose: 1000,
        }); 
      }else if(this.password == ""){
        toast.warning("Напишите свой пароль.", {
          autoClose: 1000,
        });
      }else if(this.email == ""){
        toast.warning("Напишите свою почту.", {
          autoClose: 1000,
        });
      }else{
        try {
          const response = await signup(this.email, this.password, this.username);
          localStorage.setItem("token", response.uid);
          toast.success("Вы успешно прошли регистрацию.", {
            autoClose: 1000,
          }); 
          setTimeout(() => {
            this.$router.push({ path: "/" });
          } , 1100);
        } catch (err) {
          if(err.code === "auth/email-already-in-use"){
            toast.warning("Такой пользователь уже есть.", {
          autoClose: 1000,
        });
          }else{
            console.log(err.message);
          }
        }
      }
    },
  },
};
</script>
<template>
  <div class="form">
    <h3 class="form_title">Create Account</h3>
    <div class="form_inputs">
      <div class="form_box">
        <div class="box_img">
          <svg
            width="26"
            height="29"
            viewBox="0 0 26 29"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M13 14.5C17.1031 14.5 20.4286 11.2545 20.4286 7.25C20.4286 3.24551 17.1031 0 13 0C8.89688 0 5.57143 3.24551 5.57143 7.25C5.57143 11.2545 8.89688 14.5 13 14.5ZM18.2 16.3125H17.2308C15.9424 16.8902 14.5089 17.2188 13 17.2188C11.4911 17.2188 10.0634 16.8902 8.7692 16.3125H7.8C3.49375 16.3125 0 19.7223 0 23.925V26.2812C0 27.7822 1.24777 29 2.78571 29H23.2143C24.7522 29 26 27.7822 26 26.2812V23.925C26 19.7223 22.5063 16.3125 18.2 16.3125Z"
              fill="black"
            />
          </svg>
        </div>
        <input
          type="text"
          v-model="username"
          class="form_input"
          placeholder="Name"
        />
      </div>
      <div class="form_box">
        <div class="box_img">
          <svg
            width="31"
            height="22"
            viewBox="0 0 31 22"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M25.7083 0.333328H5.29163C4.1313 0.333328 3.01851 0.754756 2.19803 1.5049C1.37756 2.25505 0.916626 3.27246 0.916626 4.33333V17.6667C0.916626 18.7275 1.37756 19.7449 2.19803 20.4951C3.01851 21.2452 4.1313 21.6667 5.29163 21.6667H25.7083C26.8686 21.6667 27.9814 21.2452 28.8019 20.4951C29.6224 19.7449 30.0833 18.7275 30.0833 17.6667V4.33333C30.0833 3.27246 29.6224 2.25505 28.8019 1.5049C27.9814 0.754756 26.8686 0.333328 25.7083 0.333328V0.333328ZM25.1104 2.99999L16.5354 10.84C16.3998 10.965 16.2385 11.0642 16.0608 11.1318C15.8831 11.1995 15.6925 11.2344 15.5 11.2344C15.3074 11.2344 15.1168 11.1995 14.9391 11.1318C14.7614 11.0642 14.6001 10.965 14.4645 10.84L5.88954 2.99999H25.1104ZM27.1666 17.6667C27.1666 18.0203 27.013 18.3594 26.7395 18.6095C26.466 18.8595 26.0951 19 25.7083 19H5.29163C4.90485 19 4.53392 18.8595 4.26043 18.6095C3.98694 18.3594 3.83329 18.0203 3.83329 17.6667V4.87999L12.4083 12.72C13.2286 13.4691 14.3406 13.8898 15.5 13.8898C16.6593 13.8898 17.7713 13.4691 18.5916 12.72L27.1666 4.87999V17.6667Z"
              fill="black"
            />
          </svg>
        </div>
        <input
          type="email"
          v-model="email"
          class="form_input"
          placeholder="Email"
        />
      </div>
      <div class="form_box">
        <div class="box_img">
          <svg
            width="39"
            height="34"
            viewBox="0 0 39 34"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M19.5 18.4167C19.0053 18.4116 18.5206 18.5388 18.1113 18.7812C17.702 19.0235 17.3877 19.3694 17.2107 19.7721C17.0337 20.1749 17.0025 20.6153 17.1212 21.034C17.24 21.4528 17.5031 21.8297 17.875 22.1142V24.0833C17.875 24.4591 18.0462 24.8194 18.351 25.0851C18.6557 25.3507 19.069 25.5 19.5 25.5C19.931 25.5 20.3443 25.3507 20.649 25.0851C20.9538 24.8194 21.125 24.4591 21.125 24.0833V22.1142C21.4969 21.8297 21.76 21.4528 21.8788 21.034C21.9975 20.6153 21.9663 20.1749 21.7893 19.7721C21.6123 19.3694 21.298 19.0235 20.8887 18.7812C20.4794 18.5388 19.9947 18.4116 19.5 18.4167ZM27.625 12.75V9.91667C27.625 8.03805 26.769 6.23638 25.2452 4.908C23.7215 3.57961 21.6549 2.83334 19.5 2.83334C17.3451 2.83334 15.2785 3.57961 13.7548 4.908C12.231 6.23638 11.375 8.03805 11.375 9.91667V12.75C10.0821 12.75 8.84209 13.1978 7.92785 13.9948C7.01361 14.7918 6.5 15.8728 6.5 17V26.9167C6.5 28.0438 7.01361 29.1248 7.92785 29.9219C8.84209 30.7189 10.0821 31.1667 11.375 31.1667H27.625C28.9179 31.1667 30.1579 30.7189 31.0721 29.9219C31.9864 29.1248 32.5 28.0438 32.5 26.9167V17C32.5 15.8728 31.9864 14.7918 31.0721 13.9948C30.1579 13.1978 28.9179 12.75 27.625 12.75ZM14.625 9.91667C14.625 8.7895 15.1386 7.7085 16.0529 6.91147C16.9671 6.11444 18.2071 5.66667 19.5 5.66667C20.7929 5.66667 22.0329 6.11444 22.9471 6.91147C23.8614 7.7085 24.375 8.7895 24.375 9.91667V12.75H14.625V9.91667ZM29.25 26.9167C29.25 27.2924 29.0788 27.6527 28.774 27.9184C28.4693 28.1841 28.056 28.3333 27.625 28.3333H11.375C10.944 28.3333 10.5307 28.1841 10.226 27.9184C9.92121 27.6527 9.75 27.2924 9.75 26.9167V17C9.75 16.6243 9.92121 16.2639 10.226 15.9983C10.5307 15.7326 10.944 15.5833 11.375 15.5833H27.625C28.056 15.5833 28.4693 15.7326 28.774 15.9983C29.0788 16.2639 29.25 16.6243 29.25 17V26.9167Z"
              fill="black"
            />
          </svg>
        </div>
        <input
          type="password"
          v-model="password"
          class="form_input"
          placeholder="Password"
        />
      </div>
    </div>
    <button class="form_btn" @click="signUp">SIGN UP</button>
  </div>
</template>

<style lang="scss" scoped>
@import "./SignupForm.scss";
</style>
